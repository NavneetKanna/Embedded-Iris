#include <iostream>
#include <wiringPi.h>
#include <unistd.h>

#define TRIG_PIN 23
#define ECHO_PIN 24

int main() {
    // Initialize wiringPi and set pins
    //if (wiringPiSetupGpio() == -1) {
      //  std::cout << "wiringPiSetup failed." << std::endl;
      //  return 1;
   // }

    pinMode(TRIG_PIN, OUTPUT);
    pinMode(ECHO_PIN, INPUT);

    while (true) {
        // Send a 10us pulse to trigger the ultrasonic sensor
        digitalWrite(TRIG_PIN, LOW);
        usleep(2);
        digitalWrite(TRIG_PIN, HIGH);
        usleep(10);
        digitalWrite(TRIG_PIN, LOW);

        // Wait for the ECHO_PIN to go HIGH, and record the time
        while (digitalRead(ECHO_PIN) == LOW) {}
        uint32_t start_time = micros();

        // Wait for the ECHO_PIN to go LOW, and record the time
        while (digitalRead(ECHO_PIN) == HIGH) {}
        uint32_t end_time = micros();

        // Calculate the distance based on the time it took for the sound wave to travel
        uint32_t duration = end_time - start_time;
        float distance = duration * 0.0343 / 2;

        // Print the distance to the console
        if ( 100 > duration > 50):
            std::cout << "An obstacle is detected " << distance << " centimeter before you" << std::endl;
        elseif ( duration < 50 ):
            std::cout << "An obstacle is detected very close to you" << std::endl;

        // Wait for 1 second before taking another measurement
        sleep(1);
    }

    return 0;
}
